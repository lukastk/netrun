# AUTOGENERATED! DO NOT EDIT! File to edit: nbs/netrun/02_rpc/00_base.ipynb

__all__ = ['ChannelBroken', 'ChannelClosed', 'RPCChannel', 'RPCError', 'RecvTimeout', 'SHUTDOWN_KEY', 'SyncRPCChannel']

# %% nbs/netrun/02_rpc/00_base.ipynb 3
from typing import Any, Protocol, runtime_checkable

# %% nbs/netrun/02_rpc/00_base.ipynb 5
class RPCError(Exception):
    """Base exception for RPC errors."""
    pass

# %% nbs/netrun/02_rpc/00_base.ipynb 6
class ChannelClosed(RPCError):
    """Raised when attempting to use a closed channel."""
    pass

# %% nbs/netrun/02_rpc/00_base.ipynb 7
class ChannelBroken(RPCError):
    """Raised when the channel is unexpectedly broken (e.g., other end died)."""
    pass

# %% nbs/netrun/02_rpc/00_base.ipynb 8
class RecvTimeout(RPCError):
    """Raised when recv times out."""
    pass

# %% nbs/netrun/02_rpc/00_base.ipynb 10
@runtime_checkable
class RPCChannel(Protocol):
    """Async protocol for bidirectional (key, data) message passing.

    Thread-safe - can be shared among multiple coroutines.
    """

    async def send(self, key: str, data: Any) -> None:
        """Send a message."""
        ...

    async def recv(self, timeout: float | None = None) -> tuple[str, Any]:
        """Receive a message. Blocks until available or timeout."""
        ...

    async def try_recv(self) -> tuple[str, Any] | None:
        """Non-blocking receive. Returns None if no message."""
        ...

    async def close(self) -> None:
        """Close the channel."""
        ...

    @property
    def is_closed(self) -> bool:
        """Whether the channel is closed."""
        ...

# %% nbs/netrun/02_rpc/00_base.ipynb 12
@runtime_checkable
class SyncRPCChannel(Protocol):
    """Sync protocol for bidirectional (key, data) message passing.

    Thread-safe - can be shared among multiple threads.
    """

    def send(self, key: str, data: Any) -> None:
        """Send a message."""
        ...

    def recv(self, timeout: float | None = None) -> tuple[str, Any]:
        """Receive a message. Blocks until available or timeout."""
        ...

    def try_recv(self) -> tuple[str, Any] | None:
        """Non-blocking receive. Returns None if no message."""
        ...

    def close(self) -> None:
        """Close the channel."""
        ...

    @property
    def is_closed(self) -> bool:
        """Whether the channel is closed."""
        ...

# %% nbs/netrun/02_rpc/00_base.ipynb 14
SHUTDOWN_KEY = "__rpc_shutdown__"
"""Sent to signal graceful shutdown."""
